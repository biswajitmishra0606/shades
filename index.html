<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shades NFT Mint</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2rem;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      background: #00df9a;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #000;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: 100px;
      margin-right: 10px;
    }
    .mint-box {
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>üÉè Shades NFT Mint</h1>

  <div>
    <button onclick="connectWallet()">Connect Wallet</button>
    <p id="walletAddress">Wallet not connected</p>
  </div>

  <div class="mint-box">
    <h3>Total Minted: <span id="totalMinted">0</span> / 52</h3>
  </div>

  <div class="mint-box">
    <input type="number" id="freeMintAmount" placeholder="1-25" min="1" max="25" />
    <button onclick="freeMint()">Free Mint</button>
  </div>

  <div class="mint-box">
    <input type="number" id="paidMintAmount" placeholder="1-25" min="1" max="25" />
    <button onclick="paidMint()">Paid Mint</button>
  </div>

  <p id="status"></p>

  <script>
    const contractAddress = "0x3764c901B946cd1F30CA0502A9B754ef48245104";
    const baseSepoliaChainId = "0x14A34";

    const abi = [
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"freeMint","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"paidMint","outputs":[],"stateMutability":"payable","type":"function"},
      {"inputs":[],"name":"PRICE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalMinted","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
    ];

    let web3;
    let contract;
    let account;

    async function connectWallet() {
      if (window.ethereum) {
        try {
          const chainId = await ethereum.request({ method: 'eth_chainId' });
          if (chainId !== baseSepoliaChainId) {
            await ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: baseSepoliaChainId }]
            });
          }

          web3 = new Web3(window.ethereum);
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
          account = accounts[0];
          document.getElementById("walletAddress").innerText = "Connected: " + account;
          contract = new web3.eth.Contract(abi, contractAddress);
          updateTotalMinted();
        } catch (error) {
          document.getElementById("status").innerText = "‚ö†Ô∏è Wallet connection failed.";
          console.error(error);
        }
      } else {
        alert("MetaMask not found. Install it first.");
      }
    }

    async function updateTotalMinted() {
      try {
        const total = await contract.methods.totalMinted().call();
        document.getElementById("totalMinted").innerText = total;
      } catch (err) {
        console.error("Failed to fetch total minted", err);
      }
    }

    async function freeMint() {
      const amount = parseInt(document.getElementById("freeMintAmount").value);
      if (!contract || !account || !amount || amount < 1 || amount > 25) {
        document.getElementById("status").innerText = "‚ö†Ô∏è Enter valid free mint amount.";
        return;
      }
      try {
        document.getElementById("status").innerText = "Minting free NFTs...";
        await contract.methods.freeMint(amount).send({ from: account });
        document.getElementById("status").innerText = "‚úÖ Free mint successful!";
        updateTotalMinted();
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "‚ùå Free mint failed.";
      }
    }

    async function paidMint() {
      const amount = parseInt(document.getElementById("paidMintAmount").value);
      if (!contract || !account || !amount || amount < 1 || amount > 25) {
        document.getElementById("status").innerText = "‚ö†Ô∏è Enter valid paid mint amount.";
        return;
      }
      try {
        const price = await contract.methods.PRICE().call();
        const totalPrice = web3.utils.toBN(price).mul(web3.utils.toBN(amount));
        const encodedData = contract.methods.paidMint(amount).encodeABI();

        const txParams = {
          from: account,
          to: contractAddress,
          value: web3.utils.toHex(totalPrice),
          data: encodedData,
          gas: '300000'
        };

        document.getElementById("status").innerText = "Minting paid NFTs...";
        await ethereum.request({
          method: 'eth_sendTransaction',
          params: [txParams]
        });

        document.getElementById("status").innerText = "‚úÖ Paid mint successful!";
        updateTotalMinted();
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "‚ùå Paid mint failed.";
      }
    }
  </script>

</body>
</html>
